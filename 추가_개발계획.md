# 추가 개발 계획 (FLAME + AU45 Blink 최소 통합)

## 목표
- 외부 FLAME(Acting Challenge) 입력에서도 **눈 깜빡임(AU45)** 이 반영되도록 최소 확장
- 카메라 트랙은 **학습 데이터 그대로 유지** (SyncTalk 방식)
- 중복/충돌 신호는 제거하고, **FLAME + AU45만** 사용

---

## 합의된 방향
- **헤드 포즈/카메라 재학습은 하지 않음** (카메라 트랙 고정)
- **AU는 AU45만 사용** (다른 AU는 제거)
- **FLAME는 표정/턱/포즈 입력으로 유지**
- 입력 구조는 **분리 입력**: `a = FLAME(56)`, `e = AU45(1)`

---

## 현재 상태 요약
- FLAME exp+pose로 `flame_params.npy` 생성/사용 중
- AU 경로가 flame 모드에서 비활성화되어 blink 입력이 끊김
- EMOCA는 AU 벡터를 직접 제공하지 않음 (AU45는 별도 추출 필요)

---

## 개선 계획

### 1) 데이터 준비
1. **FLAME 재추출 (EMOCA)**
   - 대상: Macron + Acting Challenge
   - 출력: `exp(50) + pose(6) = flame_params.npy`
   - 통계: `flame_params_stats.npz` (macron 기준)

2. **AU45 재추출 (OpenFace)**
   - 대상: Macron + Acting Challenge
   - 출력: `au.csv`에서 **AU45_r만 사용**
   - 정규화: `clip(0,2) / 2` (기존 blink 스케일 유지)

---

### 2) 입력 설계
- `a = flame_params (56)`
- `e = au45_only (1)`
- 다른 AU(눈썹/입)는 사용하지 않음

---

### 3) 코드 변경 지점
1. **dataset_readers.py**
   - flame 모드에서도 `au.csv` 로드 유지
   - `talking_dict['au45']` 추가 (1-d)

2. **gaussian_renderer/__init__.py**
   - `flame_params` → `a`
   - `au45` → `e`

3. **scene/motion_net.py**
   - `use_exp=True` 유지
   - `exp_in_dim = 1`로 처리
   - eye 분기(eye_att_net)가 `e`를 받아 동작하도록 유지

---

### 4) 학습/검증
1. **Macron 오버피팅 재학습**
   - 입력: FLAME + AU45
   - 목적: blink 반영 확인

2. **Acting Challenge 추론**
   - FLAME(Acting) + AU45(Acting)
   - 좌우 비교 영상으로 blink 반영 확인

---

## 실패 시 배타적 소거 규칙
- OpenFace AU45 추출 실패 → **AU45 입력 제거**, FLAME-only로 진행
- Acting AU45가 불완전하면 → Macron AU45만으로 학습 유지, 추론은 FLAME-only
- AU45 분포가 이상하면 → 정규화 확인 후 재추출

---

## 구현 가능성
- **높음**: 기존 구조에 최소 변경으로 blink 복구 가능
- 리스크: AU45 추출 품질(OpenFace)과 정규화 불일치

---

## 참고
- EMOCA exp는 AU 벡터와 1:1 대응하지 않음
- AU45는 기존 TalkingGaussian에서 **입력(e) + 샘플링**에 모두 사용되던 신호
- 카메라 트랙은 고정되어 있으므로, head motion은 그대로 유지됨
